<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå: ‡πÇ‡∏•‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</title>
    
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

    <script>
        // Component: ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ô‡∏¥‡πâ‡∏ß (Gesture Detector)
        AFRAME.registerComponent("gesture-detector", {
            schema: { element: { default: "" } },
            init: function() {
                this.targetElement = this.data.element && document.querySelector(this.data.element);
                if (!this.targetElement) this.targetElement = this.el;
                this.internalState = { previousState: null };
                this.emitGestureEvent = this.emitGestureEvent.bind(this);
                this.targetElement.addEventListener("touchstart", this.emitGestureEvent);
                this.targetElement.addEventListener("touchend", this.emitGestureEvent);
                this.targetElement.addEventListener("touchmove", this.emitGestureEvent);
            },
            emitGestureEvent(event) {
                const currentState = this.getTouchState(event);
                const previousState = this.internalState.previousState;
                const gestureContinues = previousState && currentState && currentState.touchCount == previousState.touchCount;
                const gestureEnded = previousState && !gestureContinues;
                const gestureStarted = currentState && !gestureContinues;

                if (gestureEnded) this.el.emit("gesture-end");
                if (gestureStarted) this.el.emit("gesture-start");
                if (gestureContinues) {
                    const eventDetail = {
                        positionChange: { x: currentState.position.x - previousState.position.x, y: currentState.position.y - previousState.position.y },
                        spreadChange: currentState.spread - previousState.spread
                    };
                    if (currentState.touchCount == 2) this.el.emit("twofingermove", eventDetail);
                    else this.el.emit("onefingermove", eventDetail);
                }
                this.internalState.previousState = currentState;
            },
            getTouchState(event) {
                if (event.touches.length === 0) return null;
                const touchList = [];
                for (let i = 0; i < event.touches.length; i++) touchList.push(event.touches[i]);
                const touchCenter = touchList.reduce((acc, t) => ({ x: acc.x + t.clientX, y: acc.y + t.clientY }), { x: 0, y: 0 });
                touchCenter.x /= touchList.length; touchCenter.y /= touchList.length;
                const spread = touchList.length < 2 ? 0 : Math.sqrt(Math.pow(touchList[0].clientX - touchList[1].clientX, 2) + Math.pow(touchList[0].clientY - touchList[1].clientY, 2));
                return { touchCount: touchList.length, position: touchCenter, spread: spread };
            }
        });

        // Component: ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• (Gesture Handler)
        AFRAME.registerComponent("gesture-handler", {
            schema: {
                enabled: { default: true },
                rotationFactor: { default: 5 }, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô
                minScale: { default: 0.1 },     // ‡∏¢‡πà‡∏≠‡∏™‡∏∏‡∏î
                maxScale: { default: 8 },       // ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏™‡∏∏‡∏î
            },
            init: function() {
                this.handleScale = this.handleScale.bind(this);
                this.handleRotation = this.handleRotation.bind(this);
                this.isVisible = false;
                this.initialScale = this.el.object3D.scale.clone();
                this.scaleFactor = 1;
                this.el.sceneEl.addEventListener("markerFound", (e) => this.isVisible = true);
                this.el.sceneEl.addEventListener("markerLost", (e) => this.isVisible = false);
                this.el.sceneEl.addEventListener("twofingermove", this.handleScale);
                this.el.sceneEl.addEventListener("onefingermove", this.handleRotation);
            },
            handleRotation: function(event) {
                if (this.isVisible) {
                    this.el.object3D.rotation.y += event.detail.positionChange.x * this.data.rotationFactor * 0.005; // ‡∏´‡∏°‡∏∏‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤
                    this.el.object3D.rotation.x += event.detail.positionChange.y * this.data.rotationFactor * 0.005; // ‡∏´‡∏°‡∏∏‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á
                }
            },
            handleScale: function(event) {
                if (this.isVisible) {
                    this.scaleFactor *= 1 + event.detail.spreadChange / window.innerWidth;
                    this.scaleFactor = Math.min(Math.max(this.scaleFactor, this.data.minScale), this.data.maxScale);
                    this.el.object3D.scale.x = this.scaleFactor * this.initialScale.x;
                    this.el.object3D.scale.y = this.scaleFactor * this.initialScale.y;
                    this.el.object3D.scale.z = this.scaleFactor * this.initialScale.z;
                }
            }
        });
    </script>

    <style>
        body { margin: 0; overflow: hidden; font-family: 'Kanit', sans-serif; }

        /* --- UI ‡∏´‡∏ô‡πâ‡∏≤ Home --- */
        #home-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0b0f19 0%, #1a2a6c 50%, #b21f1f 100%);
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .planet-icon { font-size: 100px; margin-bottom: 20px; animation: float 3s infinite; }
        h1 { font-size: 2.5em; line-height: 1.2; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin: 0; }
        h2 { font-size: 1.2em; color: #ffcc00; font-weight: 300; margin: 10px 0 40px 0; }
        
        .btn-start {
            background: linear-gradient(90deg, #ff512f, #dd2476); color: white; border: none; padding: 15px 60px;
            font-size: 1.5em; font-family: 'Kanit', sans-serif; font-weight: bold; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 20px rgba(221, 36, 118, 0.5); transition: all 0.3s ease; animation: pulse 2s infinite;
        }
        .btn-start:hover { transform: scale(1.05); }

        /* --- UI ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö --- */
        #ui-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none; z-index: 1000; }
        .btn-back { pointer-events: auto; position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.9); border: none; padding: 10px 20px; border-radius: 30px; font-family: 'Kanit', bold; cursor: pointer; }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö */
        .controls-hint {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.8); font-size: 0.9em; pointer-events: none;
            text-shadow: 1px 1px 2px black;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(221, 36, 118, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
    </style>
</head>
<body>

    <div id="home-screen">
        <div class="planet-icon">üåç</div>
        <h1>‡πÇ‡∏•‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</h1>
        <h2>‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2</h2>
        <button class="btn-start" onclick="startCamera()">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
    </div>

    <div id="ui-layer">
        <button class="btn-back" onclick="stopCamera()">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        <div class="controls-hint">üëÜ 1 ‡∏ô‡∏¥‡πâ‡∏ß‡∏´‡∏°‡∏∏‡∏ô | ‚úåÔ∏è 2 ‡∏ô‡∏¥‡πâ‡∏ß‡∏ã‡∏π‡∏°</div>
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 2; uiScanning: no;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        gesture-detector>

        <a-assets>
            <a-asset-item id="model-earth" src="./eart.1blend.glb"></a-asset-item>
            <a-asset-item id="model-core" src="./_core2.glb"></a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-entity 
                gltf-model="#model-core" 
                rotation="90 0 0" position="0 0 0" scale="0.5 0.5 0.5" 
                gesture-handler>
            </a-entity>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 1">
            <a-entity 
                gltf-model="#model-earth" 
                rotation="90 0 0" position="0 0 0" scale="0.5 0.5 0.5" 
                gesture-handler>
            </a-entity>
        </a-entity>

    </a-scene>

    <script>
        function startCamera() {
            document.getElementById('home-screen').style.transform = 'translateY(-100%)';
            document.getElementById('ui-layer').style.display = 'block';
        }
        function stopCamera() {
            document.getElementById('home-screen').style.transform = 'translateY(0%)';
            setTimeout(() => { document.getElementById('ui-layer').style.display = 'none'; }, 500);
        }
    </script>
</body>
</html>